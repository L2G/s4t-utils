#!/usr/bin/env ruby
# -*- Mode: Ruby -*-

require 's4t-utils'
include S4tUtils

require "fileutils"
include FileUtils
require 'rbconfig/datadir'

def templates_below(root)
  Pathname.new(root) + 'data' + 's4t-utils' + 'make-simple-ruby-project'
end

without_pleasant_exceptions do
  # Orient ourselves. First, assume running out of the s4t-utils
  # source tree.
  templates = templates_below(Pathname.new(__FILE__).parent.parent)

  # Otherwise, assume running from setup.rb or gem installation.
  unless File.directory?(templates)
    templates = templates_below(Config.datadir('s4t-utils'))
  end

  user_claims(File.directory?(templates)) {
    "Could not find the folder of s4t-util template files to install.\nExpecting: #{templates}"
  }


  dest_project_root = ARGV[0]
  user_claims(dest_project_root) { "Usage: #{$0} project-root" }
  dest_project_root = Pathname(dest_project_root)
  user_disputes(File.exist?(dest_project_root)) { 
    "#{dest_project_root} already exists."
  }

  ## OK, here we go!

  mkdir_p(dest_project_root + 'lib')
  mkdir_p(dest_project_root + 'bin')
  mkdir_p(dest_project_root + 'test')
  mkdir_p(dest_project_root + 'templates')

  cp(templates + 'setup.rb', dest_project_root + 'setup.rb')
  cp(templates + 'bin-skeleton', dest_project_root + 'templates')
  cp(templates + 'test-skeleton', dest_project_root + 'templates')

  puts "Now would be a good time to put the project under version control."
end
